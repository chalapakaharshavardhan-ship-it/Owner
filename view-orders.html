<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders for rkk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="nav-profile.css">
    <link rel="stylesheet" href="view-orders.css">
</head>
<body>
    <header class="navbar">
      <div class="nav-inner">
        <div class="brand">
          <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" class="bi bi-check2-square" viewBox="0 0 16 16">
              <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5z"/>
              <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0"/>
            </svg>
          </div>
          <span class="brand-name">TaskPro</span>
        </div>
        <div class="nav-actions">
          <a href="dashboard.html" class="dashboard-pill">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" class="bi bi-house" viewBox="0 0 16 16">
              <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
            </svg>
            <span class="dashboard-text">Dashboard</span>
          </a>
          <div class="profile" id="profile">
            <div id="profileIcon" class="profile-trigger">
              <!-- JS will inject the profile image here -->
            </div>
            <div id="profileDropdown" class="profile-dropdown">
              <ul>
                <li><a href="#" id="settingsLink">Settings</a></li>
                <li><a href="#" id="logoutLink">Logout</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
        <!-- Header Container -->
        <div class="header-card">
            <div class="header-container">
                <div class="top-bar">
                    <div>
                        <h1 class="page-title">Orders for rkk</h1>
                        <p class="subtitle">View and manage orders for this customer</p>
                    </div>
                    <a href="customers.html" class="back-btn">‚Üê Back to Customers</a>
                </div>
            </div>
        </div>

        <!-- Search & Filter -->
        <div class="search-filter-card">
            <div class="search-filter-container">
                <div style="width: 50%; display: flex; align-items: center; gap: 10px;">
                    <input type="text" id="searchInput" placeholder="Search orders..." class="search-box">
                    <button class="search-btn" onclick="filterOrders()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10.5" cy="10.5" r="7.5" stroke="white" stroke-width="2"/>
                            <line x1="15.5" y1="15.5" x2="21.5" y2="21.5" stroke="white" stroke-width="2"/>
                        </svg>
                        Search
                    </button>
                </div>
                <div style="width: 50%; display: flex; align-items: center; gap: 10px;">
                    <label for="status" class="filter-label">Filter by status:</label>
                    <select id="statusFilter" class="filter-dropdown" onchange="filterOrders()">
                        <option value="All">All Statuses</option>
                        <option value="Pending">Pending</option>
                        <option value="Processing">Processing</option>
                        <option value="Shipped">Shipped</option>
                        <option value="Delivered">Delivered</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="table-container">
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Date</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="ordersBody">
                    <tr id="noOrdersRow" style="display: none;">
                        <td colspan="6">
                            <div class="empty-state">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v16h12V4H6zm2 2h8v2H8V6zm0 4h8v2H8v-2zm0 4h5v2H8v-2z" fill="#666"/>
                                </svg>
                                No orders found
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>ORD54321</td>
                        <td>2025-09-10</td>
                        <td>Women Dresses, Scarf</td>
                        <td>$149.99</td>
                        <td>Pending</td>
                        <td><a href="#">View</a></td>
                    </tr>
                    <tr>
                        <td>ORD54322</td>
                        <td>2025-09-18</td>
                        <td>Men Shirts, Belt</td>
                        <td>$79.50</td>
                        <td>Shipped</td>
                        <td><a href="#">View</a></td>
                    </tr>
                    <tr>
                        <td>ORD54323</td>
                        <td>2025-09-27</td>
                        <td>Kids Wear, Socks</td>
                        <td>$45.25</td>
                        <td>Cancelled</td>
                        <td><a href="#">View</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Profile Edit Popup -->
    <div class="profile-popup" id="profilePopup" style="display:none;">
      <div class="popup-inner">
        <div class="popup-header">
          <h2>Edit Profile</h2>
          <button class="close-btn" id="closeProfilePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img id="profileImg" alt="Profile" style="width: 100px; height: 100px; border-radius: 50%;" />
          <input type="file" id="photoInput" accept="image/*" style="display: none;" />
          <button id="changePhoto" class="image-btn">Change Photo</button>
        </div>
        <form id="profileForm" class="ecommerce-form">
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="username" value="owner" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" value="owner@signaltone.com" />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save Changes</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <script>
        function filterOrders() {
            const searchValue = document.getElementById("searchInput").value.toLowerCase();
            const statusFilter = document.getElementById("statusFilter").value;
            const table = document.getElementById("ordersTable");
            const tbody = document.getElementById("ordersBody");
            const rows = tbody.getElementsByTagName("tr");
            const noOrdersRow = document.getElementById("noOrdersRow");
            let visibleCount = 0;

            for (let i = 0; i < rows.length; i++) {
                if (rows[i].id === "noOrdersRow") {
                    continue; // Skip the no orders row
                }
                const cells = rows[i].getElementsByTagName("td");
                const orderId = cells[0].textContent.toLowerCase();
                const items = cells[2].textContent.toLowerCase();
                const status = cells[4].textContent;

                // Check if searchValue matches status exactly (case-insensitive) or other fields
                const matchesSearch = searchValue === '' || 
                                     orderId.includes(searchValue) || 
                                     items.includes(searchValue) || 
                                     status.toLowerCase() === searchValue;
                const matchesStatus = statusFilter === "All" || status === statusFilter;

                if (matchesSearch && matchesStatus) {
                    rows[i].style.display = "";
                    visibleCount++;
                } else {
                    rows[i].style.display = "none";
                }
            }

            // Toggle "No Orders Found" row
            noOrdersRow.style.display = (visibleCount === 0) ? "" : "none";
        }

        // Profile functionality (same logic as category.html)
        document.addEventListener("DOMContentLoaded", () => {
          const savedUsername = localStorage.getItem("username") || "owner";
          const savedEmail = localStorage.getItem("email") || "owner@signaltone.com";
          const savedProfileImg = localStorage.getItem("profileImg") || "download.jpeg";

          const profileIcon = document.getElementById("profileIcon");
          const profileImg = document.getElementById("profileImg");
          const profileTrigger = document.querySelector(".profile-trigger");
          const profilePopup = document.getElementById("profilePopup");
          const profileForm = document.getElementById("profileForm");
          const usernameInput = document.getElementById("username");
          const emailInput = document.getElementById("email");
          const photoInput = document.getElementById("photoInput");
          const changePhotoBtn = document.getElementById("changePhoto");
          const closeProfilePopupBtn = document.getElementById("closeProfilePopupBtn");
          const profileDropdown = document.getElementById("profileDropdown");
          const settingsLink = document.getElementById("settingsLink");
          const logoutLink = document.getElementById("logoutLink");

          // Set profile image and info in header
          profileIcon.innerHTML = `<img src="${savedProfileImg}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;

          profileTrigger.addEventListener("click", (e) => {
            e.preventDefault();
            profileDropdown.style.display = profileDropdown.style.display === "block" ? "none" : "block";
          });

          settingsLink.addEventListener("click", (e) => {
            e.preventDefault();
            profileDropdown.style.display = "none";
            profilePopup.style.display = "flex";
            profileImg.src = savedProfileImg;
            usernameInput.value = savedUsername;
            emailInput.value = savedEmail;
          });

          logoutLink.addEventListener("click", (e) => {
            e.preventDefault();
            profileDropdown.style.display = "none";
            if (confirm("Are you sure you want to logout?")) {
              localStorage.removeItem("username");
              localStorage.removeItem("email");
              localStorage.removeItem("profileImg");
              window.location.href = "index.html";
            }
          });

          changePhotoBtn.addEventListener("click", () => {
            photoInput.click();
          });

          photoInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                profileImg.src = event.target.result;
                profileIcon.innerHTML = `<img src="${event.target.result}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
              };
              reader.readAsDataURL(file);
            }
          });

          profileForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const username = usernameInput.value;
            const email = emailInput.value;
            const profileImgSrc = profileImg.src;
            localStorage.setItem("username", username);
            localStorage.setItem("email", email);
            localStorage.setItem("profileImg", profileImgSrc);
            profileIcon.innerHTML = `<img src="${profileImgSrc}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
            profilePopup.style.display = "none";
          });

          document.querySelector("#profilePopup .cancel-btn").addEventListener("click", () => {
            profilePopup.style.display = "none";
            usernameInput.value = localStorage.getItem("username") || "owner";
            emailInput.value = localStorage.getItem("email") || "owner@signaltone.com";
            profileImg.src = localStorage.getItem("profileImg") || "download.jpeg";
            profileIcon.innerHTML = `<img src="${profileImg.src}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
          });

          closeProfilePopupBtn.addEventListener("click", () => {
            profilePopup.style.display = "none";
          });

          // Close dropdown when clicking outside
          document.addEventListener("click", (e) => {
            if (
              !profileTrigger.contains(e.target) &&
              !profileDropdown.contains(e.target)
            ) {
              profileDropdown.style.display = "none";
            }
          });
        });
    </script>
</body>
</html>